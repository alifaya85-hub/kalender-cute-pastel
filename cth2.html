<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Calendar — Cute Pastel Chibi</title>
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#FFF7FB;
      --card:#FFF1F7;
      --muted:#A48DAA;
      --accent1:#FFDDE6; /* pink */
      --accent2:#FFF5D6; /* cream */
      --accent3:#E8F7FF; /* baby blue */
      --accent4:#EAFDE4; /* mint */
      --shadow: 0 8px 20px rgba(34,20,40,0.06);
      --glass: rgba(255,255,255,0.6);
      font-family: 'Quicksand', system-ui, -apple-system, 'Segoe UI', Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background: linear-gradient(180deg,var(--bg),#FFF);
      display:flex; align-items:center; justify-content:center; padding:18px;
      -webkit-font-smoothing:antialiased; color:#3b2f3f;
    }

    .app{
      width:100%; max-width:960px; background:linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.98));
      border-radius:20px; padding:20px; box-shadow:var(--shadow); position:relative; overflow:hidden;
      display:grid; grid-template-columns: 320px 1fr; gap:18px;
    }

    /* Left panel */
    .panel{background:var(--card); border-radius:16px; padding:14px; box-shadow:var(--shadow)}
    .header{display:flex; align-items:center; gap:12px}
    .month{font-size:20px; font-weight:700}
    .controls{margin-left:auto; display:flex; gap:8px}
    .btn{background:var(--glass); border:none; padding:8px 10px; border-radius:10px; cursor:pointer; font-weight:600}
    .small{font-size:12px}

    .mini-calendar{display:grid; grid-template-columns: repeat(7,1fr); gap:6px; margin-top:12px}
    .day{padding:8px; text-align:center; border-radius:8px; font-size:13px}
    .day.today{background:var(--accent3); color:#053a53; font-weight:700}
    .day.other{opacity:0.4}

    /* Right main calendar */
    .main{display:flex; flex-direction:column; gap:12px}
    .weekdays{display:grid; grid-template-columns: repeat(7,1fr); text-align:center; color:var(--muted); font-size:13px}
    .grid{display:grid; grid-template-columns: repeat(7,1fr); gap:8px}
    .cell{min-height:90px; background:linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.4)); border-radius:12px; padding:8px; position:relative; overflow:hidden}
    .cell.inactive{opacity:0.35}
    .date-num{position:absolute; top:8px; right:8px; font-size:12px; color:var(--muted)}
    .events{margin-top:28px; display:flex; flex-direction:column; gap:6px}
    .event{background:var(--accent1); padding:6px 8px; border-radius:10px; font-size:13px; box-shadow: 0 6px 12px rgba(34,20,40,0.04)}

    .add-btn{position:fixed; right:34px; bottom:34px; background:linear-gradient(145deg,var(--accent4),var(--accent3)); border:none; padding:14px 18px; border-radius:16px; font-weight:700; box-shadow:var(--shadow); cursor:pointer}

    /* modal */
    .modal{position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(10,10,10,0.25); visibility:hidden; opacity:0; transition:all .18s}
    .modal.show{visibility:visible; opacity:1}
    .card{background:white; border-radius:16px; padding:18px; width:320px; box-shadow:var(--shadow)}
    label{font-size:13px; color:var(--muted); display:block; margin-top:8px}
    input,textarea,select{width:100%; padding:10px; border-radius:10px; border:1px solid rgba(60,40,60,0.06); margin-top:6px}

    /* chibi */
    .chibi{position:absolute; left:-40px; bottom:-20px; transform:rotate(-8deg); opacity:0.95; pointer-events:none}

    /* responsive */
    @media(max-width:880px){
      .app{grid-template-columns: 1fr;}
      .panel{order:2}
      .chibi{left:auto; right:-30px; bottom:-40px; transform:rotate(6deg) scale(0.9)}
    }

    /* small animations */
    .day, .cell, .btn, .add-btn{transition:transform .14s ease, box-shadow .14s}
    .day:hover, .cell:hover, .btn:hover, .add-btn:hover{transform:translateY(-6px)}
  </style>
</head>
<body>
  <div class="app" id="app">
    <div class="panel">
      <div class="header">
        <div>
          <div style="font-size:12px;color:var(--muted)">Cute Calendar</div>
          <div class="month" id="currentMonth">-</div>
        </div>
        <div class="controls">
          <button class="btn" id="prev">◀</button>
          <button class="btn" id="next">▶</button>
        </div>
      </div>

      <div style="margin-top:12px">
        <div style="font-size:13px;color:var(--muted)">Mini view</div>
        <div class="mini-calendar" id="mini"></div>
      </div>

      <div style="margin-top:12px">
        <div style="font-size:13px;color:var(--muted);display:flex;align-items:center;justify-content:space-between">
          <div>Event list</div>
          <button class="btn small" id="requestPerm">Minta Notifikasi</button>
        </div>
        <div id="eventList" style="margin-top:8px"></div>
      </div>
    </div>

    <div class="main panel">
      <div style="display:flex;align-items:center;gap:12px">
        <div style="font-weight:700">Kalender Bulanan</div>
        <div style="color:var(--muted);font-size:13px" id="subtitle">Pilih tanggal untuk lihat / tambah</div>
      </div>
      <div class="weekdays">
        <div>Min</div><div>Sen</div><div>Sel</div><div>Rab</div><div>Kam</div><div>Jum</div><div>Sab</div>
      </div>
      <div class="grid" id="grid"></div>
    </div>

    <button class="add-btn" id="openAdd">+ Tambah Jadwal</button>

    <!-- modal -->
    <div class="modal" id="modal">
      <div class="card">
        <div style="display:flex;align-items:center;justify-content:space-between">
          <div style="font-weight:700">Tambah / Edit Jadwal</div>
          <button id="closeModal" class="btn small">✕</button>
        </div>
        <label>Judul</label>
        <input id="title" placeholder="Bimbingan belajar, Meeting...">
        <label>Tanggal & Waktu</label>
        <input id="date" type="date">
        <input id="time" type="time">
        <label>Pengulangan</label>
        <select id="repeat">
          <option value="none">Sekali</option>
          <option value="daily">Harian</option>
          <option value="weekly">Mingguan</option>
        </select>
        <label>Catatan (opsional)</label>
        <textarea id="note" rows="3" placeholder="Catatan..."></textarea>
        <div style="display:flex;gap:8px;margin-top:12px">
          <button class="btn" id="save">Simpan</button>
          <button class="btn" id="delete" style="background:transparent">Hapus</button>
        </div>
      </div>
    </div>

    <!-- cute chibi SVG (simple license-friendly) -->
    <svg class="chibi" width="220" height="220" viewBox="0 0 220 220" fill="none" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <linearGradient id="g1" x1="0" x2="1" y1="0" y2="1">
          <stop offset="0" stop-color="#FFDDEE"/>
          <stop offset="1" stop-color="#FFF5D6"/>
        </linearGradient>
      </defs>
      <rect x="10" y="40" width="200" height="160" rx="28" fill="url(#g1)" opacity="0.95" />
      <!-- head -->
      <circle cx="110" cy="82" r="40" fill="#FFF" stroke="#FFDDE6" stroke-width="6"/>
      <!-- hair -->
      <path d="M75 74 C82 40,138 40,145 74 C128 64,92 64,75 74 Z" fill="#E8A8D6"/>
      <!-- eyes -->
      <ellipse cx="95" cy="84" rx="8" ry="10" fill="#2F1B2E" />
      <ellipse cx="125" cy="84" rx="8" ry="10" fill="#2F1B2E" />
      <circle cx="98" cy="80" r="2.2" fill="#fff" />
      <circle cx="128" cy="80" r="2.2" fill="#fff" />
      <!-- blush -->
      <ellipse cx="90" cy="98" rx="10" ry="6" fill="#FFD0E0" opacity="0.9" />
      <ellipse cx="130" cy="98" rx="10" ry="6" fill="#FFD0E0" opacity="0.9" />
      <!-- body -->
      <ellipse cx="110" cy="142" rx="38" ry="34" fill="#FFF7FB" stroke="#F7D9F0"/>
      <!-- heart -->
      <path d="M110 132 C115 122,135 122,135 138 C135 158,95 158,95 138 C95 122,105 122,110 132 Z" fill="#FFB3D1" opacity="0.9"/>
    </svg>
  </div>

  <script>
    // Utilities
    const now = new Date();
    let viewDate = new Date(now.getFullYear(), now.getMonth(), 1);
    const app = document.getElementById('app');

    // storage
    const EVENTS_KEY = 'cute_calendar_events_v1';
    function loadEvents(){
      try{return JSON.parse(localStorage.getItem(EVENTS_KEY) || '[]')}
      catch(e){return []}
    }
    function saveEvents(e){localStorage.setItem(EVENTS_KEY, JSON.stringify(e))}
    let events = loadEvents();

    // DOM refs
    const currentMonth = document.getElementById('currentMonth');
    const grid = document.getElementById('grid');
    const mini = document.getElementById('mini');
    const eventList = document.getElementById('eventList');
    const prev = document.getElementById('prev');
    const next = document.getElementById('next');
    const openAdd = document.getElementById('openAdd');
    const modal = document.getElementById('modal');
    const closeModal = document.getElementById('closeModal');
    const saveBtn = document.getElementById('save');
    const deleteBtn = document.getElementById('delete');
    const requestPerm = document.getElementById('requestPerm');

    const titleInput = document.getElementById('title');
    const dateInput = document.getElementById('date');
    const timeInput = document.getElementById('time');
    const repeatInput = document.getElementById('repeat');
    const noteInput = document.getElementById('note');

    let editingId = null;

    function fmtMonth(d){
      return d.toLocaleString('id-ID',{month:'long', year:'numeric'});
    }

    function startOfMonth(d){return new Date(d.getFullYear(), d.getMonth(), 1)}

    function render(){
      currentMonth.textContent = fmtMonth(viewDate);
      renderMini();
      renderGrid();
      renderEventList();
    }

    function renderMini(){
      mini.innerHTML='';
      const year = viewDate.getFullYear();
      const month = viewDate.getMonth();
      const days = new Date(year, month+1,0).getDate();
      for(let i=1;i<=days;i++){
        const el = document.createElement('div'); el.className='day'; el.textContent=i;
        const d = new Date(year,month,i);
        if(d.toDateString() === new Date().toDateString()) el.classList.add('today');
        mini.appendChild(el);
      }
    }

    function renderGrid(){
      grid.innerHTML='';
      const first = startOfMonth(viewDate);
      const startWeek = first.getDay(); // 0=Sun
      const total = new Date(viewDate.getFullYear(), viewDate.getMonth()+1,0).getDate();
      // previous month's tail
      const prevTail = startWeek;
      const prevMonthLast = new Date(viewDate.getFullYear(), viewDate.getMonth(), 0).getDate();

      const cells = [];
      for(let i=prevMonthLast - prevTail +1;i<=prevMonthLast;i++) cells.push({d:i, m:-1});
      for(let i=1;i<=total;i++) cells.push({d:i,m:0});
      while(cells.length % 7 !==0) cells.push({d: cells.length - (prevTail+total) +1, m:1});

      cells.forEach((c,idx)=>{
        const div = document.createElement('div');
        div.className = 'cell' + (c.m!==0 ? ' inactive':'' );
        const num = document.createElement('div'); num.className='date-num'; num.textContent = c.d;
        div.appendChild(num);
        const dateStr = computeDateString(c);
        const evs = eventsFor(dateStr);
        const evc = document.createElement('div'); evc.className='events';
        evs.slice(0,3).forEach(ev=>{
          const e = document.createElement('div'); e.className='event'; e.textContent = ev.title + (ev.time? ' — ' + ev.time : '');
          e.onclick = (evtt)=>{ openForEdit(ev.id) };
          evc.appendChild(e);
        });
        div.appendChild(evc);
        div.onclick = ()=>{ openForDate(dateStr) };
        grid.appendChild(div);
      });
    }

    function computeDateString(c){
      const y = viewDate.getFullYear();
      const m = viewDate.getMonth();
      let yy = y, mm = m, dd = c.d;
      if(c.m === -1) { mm = m-1; if(mm<0){mm=11; yy=y-1}} else if(c.m===1){mm = m+1; if(mm>11){mm=0; yy=y+1}};
      return new Date(yy,mm,dd).toISOString().slice(0,10);
    }

    function eventsFor(dateStr){
      return events.filter(ev => ev.date === dateStr).sort((a,b)=> (a.time||'') > (b.time||'') ? 1:-1);
    }

    function renderEventList(){
      eventList.innerHTML='';
      const upcoming = events.slice().sort((a,b)=> (a.date+' '+(a.time||'')) > (b.date+' '+(b.time||''))?1:-1);
      if(upcoming.length===0){ eventList.innerHTML='<div style="color:var(--muted);font-size:13px;margin-top:8px">Belum ada jadwal</div>'; return}
      upcoming.forEach(ev=>{
        const d = document.createElement('div'); d.className='event'; d.style.display='flex'; d.style.justifyContent='space-between'; d.style.alignItems='center';
        d.innerHTML = `<div>${ev.title} <div style="font-size:12px;color:var(--muted)">${ev.date} ${ev.time||''}</div></div>`;
        d.onclick = ()=> openForEdit(ev.id);
        eventList.appendChild(d);
      })
    }

    // modal actions
    function openModal(){ modal.classList.add('show'); }
    function closeModalFn(){ modal.classList.remove('show'); clearForm(); editingId=null; }
    closeModal.onclick = closeModalFn;
    openAdd.onclick = ()=>{ openForDate(new Date().toISOString().slice(0,10)) }

    function openForDate(dateStr){
      dateInput.value = dateStr; timeInput.value = '';
      openModal();
    }

    function openForEdit(id){
      const ev = events.find(x=>x.id===id); if(!ev) return;
      editingId = id;
      titleInput.value = ev.title; dateInput.value = ev.date; timeInput.value = ev.time || ''; repeatInput.value = ev.repeat || 'none'; noteInput.value = ev.note || '';
      openModal();
    }

    function clearForm(){ titleInput.value=''; dateInput.value=''; timeInput.value=''; repeatInput.value='none'; noteInput.value=''; }

    saveBtn.onclick = ()=>{
      const title = titleInput.value.trim(); const date = dateInput.value; const time = timeInput.value; const repeat = repeatInput.value; const note = noteInput.value;
      if(!title || !date){ alert('Isi judul dan tanggal'); return; }
      if(editingId){
        const idx = events.findIndex(e=>e.id===editingId); if(idx>=0){ events[idx] = { ...events[idx], title, date, time, repeat, note }; }
      } else {
        events.push({id: 'ev_'+Date.now(), title, date, time, repeat, note});
      }
      saveEvents(events); render(); scheduleCheck(); closeModalFn();
    }

    deleteBtn.onclick = ()=>{
      if(!editingId) return; events = events.filter(e=>e.id!==editingId); saveEvents(events); render(); closeModalFn();
    }

    // nav
    prev.onclick = ()=>{ viewDate = new Date(viewDate.getFullYear(), viewDate.getMonth()-1,1); render(); }
    next.onclick = ()=>{ viewDate = new Date(viewDate.getFullYear(), viewDate.getMonth()+1,1); render(); }

    // notifications
    function canNotify(){ return ('Notification' in window) }
    requestPerm.onclick = async ()=>{
      if(!canNotify()){ alert('Browser Anda tidak mendukung Notifikasi.'); return }
      const p = await Notification.requestPermission(); alert('Permission: '+p);
    }

    // check loop: every 30s check if any event is due (within the minute) and notify
    let notified = {}; // id_time -> true
    function checkAndNotify(){
      if(Notification.permission !== 'granted') return;
      const now = new Date();
      const nowKey = now.toISOString().slice(0,16);
      events.forEach(ev=>{
        if(!ev.time) return; // skip all-day
        const dt = new Date(ev.date + 'T' + ev.time);
        if(Math.abs(dt - now) <= 60000){ // within one minute
          const key = ev.id + '_' + ev.date + '_' + ev.time;
          if(!notified[key]){
            new Notification('Jadwal: '+ev.title, {body: ev.date + ' ' + ev.time + (ev.note? '\n' + ev.note : ''), tag: key});
            notified[key]=true;
          }
        }
      })
    }

    let checkerInterval = null;
    function scheduleCheck(){ if(checkerInterval) clearInterval(checkerInterval); checkerInterval = setInterval(checkAndNotify, 30000); }

    // initial
    render(); scheduleCheck();

    // optional: try requesting permission on first load (commented out)
    // Notification.requestPermission();

    // quick helper: if user clicks on an event in eventList while modal closed, open edit
    function openForEventPreview(id){ openForEdit(id) }

    // Friendly small hint for mobile: detect small screens
    if(window.innerWidth < 480){
      const hint = document.createElement('div'); hint.style.position='fixed'; hint.style.left='14px'; hint.style.bottom='14px'; hint.style.background='rgba(255,255,255,0.85)'; hint.style.padding='8px 12px'; hint.style.borderRadius='12px'; hint.style.fontSize='13px'; hint.style.boxShadow='var(--shadow)'; hint.textContent = 'Tip: Tambahkan ke Home Screen agar terasa seperti aplikasi'; document.body.appendChild(hint);
      setTimeout(()=> hint.remove(),7000);
    }

  </script>
</body>
</html>
